(this["webpackJsonpalexandria-react"]=this["webpackJsonpalexandria-react"]||[]).push([[0],{11:function(e,t,o){e.exports=o.p+"static/media/spinner-black.693c372b.svg"},26:function(e,t,o){e.exports=o.p+"static/media/unconvinced.1de6c75d.mp3"},30:function(e,t,o){e.exports=o(57)},35:function(e,t,o){},57:function(e,t,o){"use strict";o.r(t);var a=o(0),n=o.n(a),i=o(23),l=o.n(i),r=(o(35),o(7)),s=o(8),d=o(24),c=o(25),u=o(27),g=o(29),m=o(10),h=o.n(m),f=o(5),p=o.n(f),v=o(3),b=o(6),y=o(11),k=o.n(y),x=o(12),w=o(28),S=o(26),E=o.n(S),B=window.require("electron").ipcRenderer,R=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},C=function(e){Object(g.a)(o,e);var t=Object(u.a)(o);function o(e){var a;return Object(d.a)(this,o),(a=t.call(this,e)).updateLocalBooks=function(){B.invoke("get-local-books").then((function(e){a.setState({localBooks:e}),console.log(e)}))},a.setActiveTab=function(e){a.setState({activeTab:e,selectedBook:null}),"bookshelf"===e&&a.updateLocalBooks()},a.onSearchBoxChange=function(e){a.setState({searchBox:e.target.value}),""===e.target.value.trim()&&a.setState({searchResults:null,selectedBook:null}),a.fetchGoogleBooksDebounced(e.target.value)},a.fetchGoogleBooks=function(e){e.trim()&&h.a.get("https://www.googleapis.com/books/v1/volumes",{params:{q:e}}).then((function(t){if(a.state.searchBox===e&&t.data.items)if(t.data.items.length>0){var o=Object(b.uniqBy)(t.data.items,"id");a.setState({searchResults:o,selectedBook:t.data.items[0]}),console.log(t.data.items),a.FetchLibgenSearchResults(t.data.items[0])}else a.setState({searchResults:[],selectedBook:null})}))},a.onLibgenResultClick=function(e,t){var o={libgenResult:e,googleBook:t,status:"getting-download-page",id:t.id};a.setState({downloads:[a.state.downloads,o]}),B.invoke("download-book",{libgenBook:e,googleBook:a.state.selectedBook})},a.onBookRowClick=function(e){var t;(null===(t=a.state.selectedBook)||void 0===t?void 0:t.id)===e.id?a.setState({selectedBook:null}):(a.setState({selectedBook:e}),a.FetchLibgenSearchResults(e))},a.onLocalBookClick=function(e){B.invoke("open-book",e)},a.handleLibgenSearchResults=function(e,t){console.log(e);var o=[];e.forEach((function(e,a){if(["epub","pdf"].includes(e.extension.toLowerCase())){var n=Object(b.deburr)(t.volumeInfo.title),i=Object(b.deburr)(e.title);i=(i=i.replace(/(\[.*?\])/g,"")).replace(/(\(.*?\))/g,""),n=(n=n.replace(/(\[.*?\])/g,"")).replace(/(\(.*?\))/g,""),i=i.trim().toLowerCase(),n=n.trim().toLowerCase();p()(t.volumeInfo.publishedDate).year(),parseInt(e.year);o.push(e)}})),a.state.searchResults&&a.setState({searchResults:a.state.searchResults.map((function(e,a){return e.id===t.id?Object(s.a)({},e,{libgenMatches:o,searching:!1}):e}))})},a.FetchLibgenSearchResults=function(e){if(!e.searching&&!Array.isArray(e.libgenMatches)&&e){a.setState({searchResults:a.state.searchResults.map((function(t,o){return e.id===t.id?Object(s.a)({},t,{searching:!0}):t}))});var t=e.volumeInfo.title;t=e.volumeInfo.subtitle?t+" "+e.volumeInfo.subtitle:t,t+=" ".concat(e.volumeInfo.authors?e.volumeInfo.authors:""),B.invoke("search-libgen-nonfiction",t).then((function(o){o?0===o.length?(t=e.volumeInfo.title+" ".concat(e.volumeInfo.authors?e.volumeInfo.authors[0]:""),B.invoke("search-libgen-nonfiction",e.volumeInfo.title).then((function(t){a.handleLibgenSearchResults(t,e)}))):a.handleLibgenSearchResults(o,e):a.setState({searchResults:a.state.searchResults.map((function(t,o){return t.id===e.id?Object(s.a)({},t,{searching:!1}):t}))})}))}},a.NoCoverImage=function(e,t,o){return n.a.createElement("div",{style:{backgroundColor:"#eee",minHeight:e||t/3,minWidth:t||"100%",marginRight:20,objectFit:"contain",alignSelf:"flex-start",display:"flex",alignItems:"center"}},n.a.createElement("p",{style:{flex:1,alignSelf:"center",justifyContent:"center",color:"grey",fontSize:o,textAlign:"center"}},"No cover"))},a.SearchResults=function(e){return a.state.searchResults?a.state.searchResults.map((function(e,t){var o,i=(null===(o=a.state.selectedBook)||void 0===o?void 0:o.id)===e.id,l={initial:{opacity:0,y:60},animate:{opacity:1,y:0,transition:{delay:.03*t}}};return n.a.createElement(v.a.div,{className:"noSelect search-result-book-row",initial:"initial",animate:"animate",variants:l,onClick:function(){return a.onBookRowClick(e)},"data-index":t,key:e.id,transition:{duration:0},style:{display:"flex",paddingTop:10,paddingBottom:10,backgroundColor:i?"rgba(0,100,255,0.05)":"rgba(255,255,255,1)",border:i?"2px solid deepskyblue":"2px solid transparent",borderBottom:i?"2px solid deepskyblue":"2px solid #eee",paddingLeft:20,paddingRight:20}},e.volumeInfo.imageLinks?n.a.createElement("img",{alt:"",className:"noSelect",src:e.volumeInfo.imageLinks?e.volumeInfo.imageLinks.thumbnail:null,style:{marginRight:20,objectFit:"contain",alignSelf:"flex-start",height:100}}):a.NoCoverImage(100,70,17),n.a.createElement("div",{className:"noSelect",style:{}},n.a.createElement("p",{style:{fontWeight:"bold"}},e.volumeInfo.title,e.volumeInfo.subtitle?": "+e.volumeInfo.subtitle:null),n.a.createElement("p",{style:{color:"grey",fontSize:14,marginTop:5}},e.volumeInfo.authors?e.volumeInfo.authors.join(", "):"Author Unavailable"),n.a.createElement("p",{style:{color:"grey",fontSize:14}},p()(e.volumeInfo.publishedDate).year())))})):null},a.SelectedBook=function(e){var t,o;if(!a.state.selectedBook)return null;for(var i=0;i<a.state.searchResults.length;i++){var l=a.state.searchResults[i];l.id===a.state.selectedBook.id&&(o=l)}if(o){var s,d,c,u={initial:{opacity:0,scale:1,y:200},animate:{opacity:1,scale:1,y:0,transition:{duration:.3}}},g=!1,m=Object(r.a)(a.state.downloads);try{for(m.s();!(d=m.n()).done;){var h=d.value;if(h.id===a.state.selectedBook.id){s=h,g=!0;break}}}catch(C){m.e(C)}finally{m.f()}var f,b,y=Object(r.a)(a.state.localBooks);try{for(y.s();!(f=y.n()).done;){var x=f.value;if(a.state.selectedBook.id===x.book.id){c=x;break}}}catch(C){y.e(C)}finally{y.f()}if(c)b=n.a.createElement("div",{style:{position:"absolute",alignSelf:"flex-end",justifyContent:"flex-end",display:"flex",bottom:0,right:0,overflow:"hidden",borderRadius:4}},n.a.createElement(v.a.div,{key:o.id,variants:u,initial:"initial",animate:"animate",onClick:function(){return a.onLocalBookClick(c)},style:{backgroundColor:"dodgerblue",border:"1px solid lightgrey",boxShadow:"0px 0px 8px lightgrey",borderRadius:4,padding:20,paddingTop:10,paddingBottom:10}},n.a.createElement("p",{style:{color:"white",padding:5,fontWeight:"bold"}},"Open ",a.state.selectedBook.volumeInfo.title)));else if(g){var S,E=0;s.contentLength?(S="".concat(R(s.downloaded)," / ").concat(R(s.contentLength)),E=s.downloaded/s.contentLength*100):S="Starting download...",b=n.a.createElement("div",{style:{position:"absolute",alignSelf:"flex-end",justifyContent:"flex-end",display:"flex",bottom:0,right:0,overflow:"hidden",borderRadius:4}},n.a.createElement(v.a.div,{key:o.id,variants:u,initial:"initial",animate:"animate",style:{backgroundColor:"#eee",border:"1px solid lightgrey",boxShadow:"0px 0px 8px lightgrey",borderRadius:4,padding:20,paddingTop:10,paddingBottom:10,minWidth:440,maxWidth:440}},n.a.createElement("p",{style:{alignSelf:"center",fontSize:16}},Math.floor(E),"%"),n.a.createElement(w.a,{percent:E,strokeWidth:"1",strokeColor:"deepskyblue"}),n.a.createElement("p",{style:{alignSelf:"center",fontSize:14}},S)))}else if(o.searching)b=n.a.createElement("div",{style:{position:"absolute",alignSelf:"flex-end",justifyContent:"flex-end",display:"flex",bottom:0,right:0,overflow:"hidden",borderRadius:4}},n.a.createElement(v.a.div,{key:o.id,variants:u,initial:"initial",animate:"animate",style:{backgroundColor:"#eee",border:"1px solid lightgrey",boxShadow:"0px 0px 8px lightgrey",borderRadius:4,padding:20,paddingTop:10,paddingBottom:10}},n.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignSelf:"center"}},n.a.createElement("img",{alt:"",src:k.a,height:15,width:15,style:{marginRight:10,alignSelf:"center"}}),n.a.createElement("p",{style:{alignSelf:"center"}},"Loading sources..."))));else if(o.libgenMatches){var B=o.libgenMatches.map((function(e,t){return n.a.createElement(v.a.div,{onClick:function(){return a.onLibgenResultClick(e,a.state.selectedBook)},whileHover:{backgroundColor:"white"},key:e.id,style:{display:"flex",justifyContent:"space-between",borderTop:0===t?"2px solid lightgrey":"1px solid lightgrey",padding:20,paddingTop:5,paddingBottom:5,backgroundColor:"#eee"}},n.a.createElement("div",{style:{marginRight:15}},n.a.createElement("p",{style:{fontWeight:"bold",fontSize:14}},e.title),n.a.createElement("p",{style:{fontSize:14}},e.author)),n.a.createElement("div",{style:{justifyContent:"flex-end",alignSelf:"flex-start",minWidth:60}},n.a.createElement("p",{style:{fontWeight:"bold",textAlign:"right",fontSize:14}},e.extension),n.a.createElement("p",{style:{textAlign:"right",fontSize:14}},e.size)))}));b=n.a.createElement(v.a.div,{variants:u,initial:"initial",animate:"animate",style:{position:"absolute",maxWidth:440,minWidth:440,alignSelf:"flex-end",justifyContent:"flex-end",display:"flex",bottom:0,right:15,maxHeight:"50vh",borderTopLeftRadius:4,borderTopRightRadius:4,overflowX:"hidden",border:"1px solid lightgrey"}},n.a.createElement("div",{style:{backgroundColor:"#eee",width:"100%",boxShadow:"0px 0px 8px lightgrey",borderTopLeftRadius:4,borderTopRightRadius:4}},n.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignSelf:"center",flexDirection:"column",width:"100%"}},B.length>0?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{style:{padding:15,paddingTop:10,paddingBottom:10,display:"flex",backgroundColor:"#eee"}},n.a.createElement("h4",null,"Available versions:")),B):n.a.createElement("div",{style:{padding:15,paddingTop:10,paddingBottom:10,display:"flex",backgroundColor:"#eee"}},n.a.createElement("h4",null,"This book was not found  (\u25de\u2038\u25df\uff1b)")))))}return n.a.createElement("div",{style:{display:"flex",padding:40,paddingRight:30,paddingLeft:30,paddingBottom:"calc(50vh + 30px)",overflow:"hidden"}},b,n.a.createElement("div",{style:{alignItems:"center",justifyContent:"center"}},o.volumeInfo.imageLinks?n.a.createElement("img",{alt:"",className:"book-img",src:o.volumeInfo.imageLinks?o.volumeInfo.imageLinks.thumbnail:null,style:{marginRight:20,objectFit:"contain",minWidth:180,alignSelf:"flex-start",justifyContent:"center"}}):n.a.createElement("div",{style:{marginRight:20,objectFit:"contain",minWidth:180,alignSelf:"flex-start"}},a.NoCoverImage(250,170,18)),o.searching?n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-start"}},n.a.createElement("img",{alt:"",src:k.a,height:15,width:15,style:{marginRight:15,alignSelf:"center"}}),n.a.createElement("p",{style:{marginTop:5}},"Loading sources...")):null),n.a.createElement("div",{style:{maxWidth:600}},n.a.createElement("p",{style:{fontWeight:"bold",fontSize:22,userSelect:"text"}},o.volumeInfo.title,o.volumeInfo.subtitle?": "+o.volumeInfo.subtitle:null),n.a.createElement("p",{style:{color:"grey",userSelect:"text"}},o.volumeInfo.authors?o.volumeInfo.authors.join(", "):"Author Unavailable"),n.a.createElement("p",{style:{color:"grey",marginTop:3,userSelect:"text"}},p()(o.volumeInfo.publishedDate).year()),n.a.createElement("p",{style:{marginTop:20,marginBottom:20,userSelect:"text"}},o.volumeInfo.description),o.volumeInfo.categories?n.a.createElement(n.a.Fragment,null,n.a.createElement("p",{style:{marginTop:20,fontWeight:"bold",color:"grey"}},"Tags"),n.a.createElement("p",{style:{marginBottom:20,userSelect:"text"}},null===(t=o.volumeInfo.categories)||void 0===t?void 0:t.join(","))):null))}},a.LocalBooksResults=function(e){return a.state.localBooks?0===a.state.localBooks.length?n.a.createElement("p",{style:{padding:10,paddingLeft:20}},"Search for a book to add it to your library!"):a.state.localBooks.map((function(e,t){null===(o=a.state.selectedBook)||void 0===o||o.id,e.book.id;var o,i=e.book.volumeInfo,l={initial:{opacity:0,y:60},animate:{opacity:1,y:0,transition:{delay:.03*t}}};return n.a.createElement(v.a.div,{transition:{duration:0},className:"noSelect local-book-item",initial:"initial",animate:"animate",variants:l,onClick:function(){return a.onLocalBookClick(e)},"data-index":t,key:"local-".concat(e.book.id),whileHover:{scale:1.02,transition:{duration:.2}},whileTap:{backgroundColor:"rgba(0,100,255,.1)"},style:{display:"flex",paddingTop:10,paddingBottom:10,backgroundColor:"white",boxShadow:"6px 6px rgba(0,100,255,.1)",paddingLeft:20,paddingRight:20,maxWidth:420,minWidth:420,margin:15,borderRadius:8}},i.imageLinks?n.a.createElement("img",{alt:"",className:"noSelect",src:i.imageLinks?i.imageLinks.thumbnail:null,style:{marginRight:20,objectFit:"contain",alignSelf:"flex-start",height:100}}):a.NoCoverImage(100,70,17),n.a.createElement("div",{className:"noSelect",style:{}},n.a.createElement("p",{style:{fontWeight:"bold"}},i.title,i.subtitle?": "+i.subtitle:null),n.a.createElement("p",{style:{color:"grey",fontSize:14,marginTop:5}},i.authors?i.authors.join(", "):"Author Unavailable"),n.a.createElement("p",{style:{color:"grey",fontSize:14}},p()(i.publishedDate).year())))})):null},a.ereader=function(){return n.a.createElement("div",{id:"ereader"})},a.MainArea=function(e){return"search"===a.state.activeTab?n.a.createElement(x.a,{split:"vertical",primary:"first",allowResize:!0,defaultSize:450},n.a.createElement("div",{style:{overflow:"scroll",maxHeight:"100vh",minHeight:"100vh",position:"relative",borderRight:"1px solid lightgrey"}},n.a.createElement("div",{style:{padding:10,borderBottom:"2px solid #eee",position:"absolute",width:"100%",backgroundColor:"white",height:60}},n.a.createElement("input",{className:"noSelect",placeholder:"Enter a book title or author",type:"search",onChange:a.onSearchBoxChange,value:a.state.searchBox,style:{border:"1px solid lightgrey",padding:10,width:"100%",background:"#eee",borderRadius:8}})),n.a.createElement("div",{style:{paddingTop:60}},a.SearchResults())),n.a.createElement("div",{style:{height:"100vh",overflowX:"hidden",overflowY:"scroll"}},a.SelectedBook())):"bookshelf"===a.state.activeTab?n.a.createElement("div",{style:{overflow:"scroll",maxHeight:"100vh",minHeight:"100vh",position:"relative",borderRight:"1px solid lightgrey",background:"#eee"}},n.a.createElement("div",{style:{paddingTop:20,paddingLeft:20,paddingBottom:10,borderBottom:"2px solid #eee"}},n.a.createElement("h3",{style:{}},"My Bookshelf")),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},a.LocalBooksResults())):void 0},a.Sidebar=function(e){return n.a.createElement("div",{style:{background:"#222",minHeight:"100%",margin:0,padding:0,overflowX:"hidden",whiteSpace:"nowrap"}},n.a.createElement("div",{className:"window-button-container drag-handle",style:{paddingTop:10,paddingLeft:10,display:"flex",paddingBottom:10,position:"absolute",width:"100%"}},n.a.createElement("div",{onClick:function(){return B.invoke("window-event","close")},className:"window-button",style:{height:13,width:13,background:"#FF605C",borderRadius:"50%",marginRight:8,overflow:"hidden"}}),n.a.createElement("div",{onClick:function(){return B.invoke("window-event","minimize")},style:{height:13,width:13,background:"#FFBD44",borderRadius:"50%",marginRight:8}}),n.a.createElement("div",{onClick:function(){return B.invoke("window-event","resize")},style:{height:13,width:13,background:"#00CA4E",borderRadius:"50%",marginRight:9}})),n.a.createElement("p",{style:{marginTop:50}}),n.a.createElement("p",{onClick:function(){return a.setActiveTab("search")},style:{padding:5,paddingLeft:20,paddingRight:20,backgroundColor:"search"===a.state.activeTab?"rgba(0,0,255,.4)":"transparent",color:"white",alignSelf:"center",fontSize:14,userSelect:"none"}},"\ud83d\udd0e \xa0Get book"),n.a.createElement("p",{onClick:function(){return a.setActiveTab("bookshelf")},style:{padding:5,paddingLeft:20,paddingRight:20,backgroundColor:"bookshelf"===a.state.activeTab?"rgba(0,0,255,.4)":"transparent",color:"white",alignSelf:"center",fontSize:14,userSelect:"none"}},"\ud83d\udcda\xa0 My Bookshelf"),n.a.createElement(v.a.p,{whileHover:{color:"rgba(255,255,255,1)"},onClick:function(){return B.invoke("open-books-dir")},style:{position:"absolute",bottom:0,marginBottom:10,padding:5,paddingLeft:20,paddingRight:20,backgroundColor:"transparent",color:"rgba(255,255,255,.7)",alignSelf:"center",fontSize:14,userSelect:"none"}},"\ud83d\udcc1 Open Storage Directory"))},a.state={searchBox:"",searchResults:[],selectedBook:null,activeTab:"bookshelf",downloads:[],localBooks:null},a.fetchGoogleBooksDebounced=Object(b.debounce)(a.fetchGoogleBooks,300),a}return Object(c.a)(o,[{key:"componentDidMount",value:function(){var e=this;this.ePub=window.ePub,this.updateLocalBooks(),B.on("download-progress",(function(t,o){var a,n=[],i=Object(r.a)(e.state.downloads);try{for(i.s();!(a=i.n()).done;){var l=a.value;o.id===l.id?n.push(Object(s.a)({},l,{contentLength:o.contentLength,downloaded:o.downloaded})):n.push(l)}}catch(d){i.e(d)}finally{i.f()}e.setState({downloads:n})})),B.on("download-complete",(function(t,o){var a=[];e.state.downloads.forEach((function(t){if(t.id!==o.id)a.push(t);else{var n,i,l=t.googleBook.volumeInfo.title;new Audio(E.a).play(),new Notification(l,{body:"Download complete.",sound:!1,silent:!0,icon:null===(n=t.googleBook.volumeInfo)||void 0===n||null===(i=n.imageLinks)||void 0===i?void 0:i.thumbnail}).onclick=function(){var a,n=Object(r.a)(e.state.localBooks);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(o.id===i.book.id){e.onLocalBookClick(i);break}}}catch(l){n.e(l)}finally{n.f()}console.log(t.googleBook)}}})),e.setState({downloads:a}),e.updateLocalBooks()})),h.a.get("https://www.googleapis.com/books/v1/volumes",{params:{q:'"Stripe Press"'}}).then((function(t){e.setState({searchResults:t.data.items})}))}},{key:"render",value:function(){return n.a.createElement("div",{className:"main-container",style:{display:"flex",flexDirection:"row",overflowY:"hidden",overflowX:"hidden",minHeight:"100%",minWidth:"100%",position:"absolute",margin:0,padding:0}},n.a.createElement(x.a,{split:"vertical",primary:"first",allowResize:!0,defaultSize:250},n.a.createElement(this.Sidebar,null),n.a.createElement(this.MainArea,null)))}}]),o}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.96acca1c.chunk.js.map